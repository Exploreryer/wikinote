# Wikinote Dual Build Guide

Build both Web and Chrome Extension from a single React + TypeScript codebase.

## 🚀 Commands

- Build all targets:
```bash
npm run build:all
```

- Build Web only:
```bash
npm run build:web
```

- Build Extension only:
```bash
npm run build:extension
```

## 📁 Structure

```
frontend/
├── src/                    # Shared React code
├── configs/                # Build configs
│   ├── web/                # Web config
│   └── extension/          # Extension config
├── scripts/                # Build scripts
└── dist/                   # Outputs
    ├── web/                # Web artifacts
    └── extension/          # Extension artifacts
```

## 🔧 Dev Flow

1. Edit code under `src/`
2. Build with `npm run build:all`
3. Test:
   - Web: deploy `dist/web/`
   - Extension: load `dist/extension/` in Chrome

## 🔄 Environment Adaptation

Handled by `src/utils/environment.ts`:
- Storage: localStorage (Web) vs Chrome Storage (Extension)
- Network: use Wikipedia API with `origin=*`; no custom Origin header
- Analytics: Vercel Analytics only on Web

## 🔒 CSP (Extension)

`configs/extension/manifest.json` defines strict `extension_pages` CSP with limited `connect-src` to Wikipedia, `img-src` allowing `https` and `data`, and minimal `style-src`.

## 🖼️ Icons

The build script ensures required icons exist:
- Copies from `frontend/public/` when present
- Automatically generates missing sizes (16/32/48/128) from 512×512 (or 192×192 fallback) into `dist/extension/icons/`

## 🧪 Troubleshooting

- Build issues: run `npm run lint` and ensure dependencies are installed
- Extension load issues: check `manifest.json`, ensure icons exist (auto-generated by script), open DevTools for errors

## ✅ Best Practices

- Keep changes under `src/` and configs under `configs/`
- Test both targets after changes
- Keep comments and docs in English