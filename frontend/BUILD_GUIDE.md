# Wikinote Dual Build Guide

Build both Web and Chrome Extension from a single React + TypeScript codebase.

## ğŸš€ Commands

- Build all targets:
```bash
npm run build:all
```

- Build Web only:
```bash
npm run build:web
```

- Build Extension only:
```bash
npm run build:extension
```

## ğŸ“ Structure

```
frontend/
â”œâ”€â”€ src/                    # Shared React code
â”œâ”€â”€ configs/                # Build configs
â”‚   â”œâ”€â”€ web/                # Web config
â”‚   â””â”€â”€ extension/          # Extension config
â”œâ”€â”€ scripts/                # Build scripts
â””â”€â”€ dist/                   # Outputs
    â”œâ”€â”€ web/                # Web artifacts
    â””â”€â”€ extension/          # Extension artifacts
```

## ğŸ”§ Dev Flow

1. Edit code under `src/`
2. Build with `npm run build:all`
3. Test:
   - Web: deploy `dist/web/`
   - Extension: load `dist/extension/` in Chrome

## ğŸ”„ Environment Adaptation

Handled by `src/utils/environment.ts`:
- Storage: localStorage (Web) vs Chrome Storage (Extension)
- Network: use Wikipedia API with `origin=*`; no custom Origin header
- Analytics: Vercel Analytics only on Web

## ğŸ”’ CSP (Extension)

`configs/extension/manifest.json` defines strict `extension_pages` CSP with limited `connect-src` to Wikipedia, `img-src` allowing `https` and `data`, and minimal `style-src`.

## ğŸ–¼ï¸ Icons

The build script ensures required icons exist:
- Copies from `frontend/public/` when present
- Automatically generates missing sizes (16/32/48/128) from 512Ã—512 (or 192Ã—192 fallback) into `dist/extension/icons/`

## ğŸ§ª Troubleshooting

- Build issues: run `npm run lint` and ensure dependencies are installed
- Extension load issues: check `manifest.json`, ensure icons exist (auto-generated by script), open DevTools for errors

## âœ… Best Practices

- Keep changes under `src/` and configs under `configs/`
- Test both targets after changes
- Keep comments and docs in English